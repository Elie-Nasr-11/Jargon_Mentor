<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jargon Mentor</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500&family=Source+Code+Pro&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: white;
      --text: #0077cc;
      --accent: #c42d88;
      --green: #27c147;
    }

    * {
      box-sizing: border-box;
      border-radius: 0 !important;
    }

    html, body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--text);
      font-size: 16px;
      line-height: 1.4;
    }

    .container {
      width: 90%;
      max-width: 900px;
      margin: 0 auto;
      padding-top: 40px;
      padding-bottom: 120px;
    }

    #chat-container {
      font-family: 'Poppins', sans-serif;
      font-weight: 300;
      height: 600px;
      overflow-y: auto;
      background: #ffffff;
      padding: 1em;
      border: 2px solid transparent;
      transition: border 0.3s ease;
      white-space: pre-wrap;
      font-size: 14.5px;
      line-height: 1.5;
    }

    #chat-container.flash {
      border: 2px solid var(--green);
    }

    .user {
      color: var(--accent);
      margin: 0.5em 0;
      font-weight: bold;
    }

    .assistant {
      color: var(--text);
      margin: 0.5em 0;
      font-weight: bold;
    }

    .older {
      font-size: 0.85em;
      opacity: 0.8;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1em;
      margin-top: 40px;
      position: relative;
      top: 0;
    }

    textarea {
      padding: 1em;
      font-family: 'Source Code Pro', monospace;
      font-size: 14px;
      color: var(--green);
      border: none;
      outline: none;
      resize: none;
      overflow-y: auto;
      min-height: 20px;
      max-height: 130px;
      line-height: 1.5;
      border: 2px solid transparent;
      transition: border 0.3s ease;
    }

    textarea.flash-border {
      border: 2px solid var(--green) !important;
    }

    textarea::placeholder {
      color: var(--green);
    }

    button {
      width: 100px;
      align-self: flex-start;
      padding: 12px 24px;
      border: none;
      border-bottom: 2px solid var(--accent);
      background: transparent;
      color: var(--accent);
      font-weight: bold;
      font-family: 'Poppins', sans-serif;
      cursor: pointer;
    }

    button:hover {
      background: var(--accent);
      color: white;
    }

    code {
      font-family: 'Source Code Pro', monospace;
      font-size: 13px;
      background: transparent;
      padding: 2px 4px;
      color: var(--green);
    }

    pre {
      font-family: 'Source Code Pro', monospace;
      font-size: 13px;
      background: transparent;
      padding: 10px;
      border: 2px solid var(--green);
      overflow-x: auto;
      color: var(--green);
      position: relative;
      margin: 12px 0 8px;
      white-space: pre-wrap;
    }

    .copy-button {
      background: transparent;
      border: none;
      border-bottom: 2px solid var(--accent);
      color: var(--accent);
      padding: 12px 24px;
      font-weight: bold;
      font-family: 'Poppins', sans-serif;
      cursor: pointer;
      margin-bottom: 20px;
    }

    .copy-button:hover {
      background: var(--accent);
      color: white;
    }

    ::-webkit-scrollbar {
      width: 6px;
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background-color: var(--text);
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="chat-container"></div>
    
    <label for="lessonSelector">Choose a lesson:</label>
    <select id="lessonSelector">
      <option value="lesson1">Lesson 1: Purpose</option>
      <option value="lesson2">Lesson 2: Systems & Signals</option>
      <option value="lesson3">Lesson 3: Signal Processing</option>
      <option value="lesson4">Lesson 4: Memory</option>
      <option value="lesson5">Lesson 5: Exchanging Signals</option>
    </select>
   
    <form id="chat-form">
      <textarea id="user-input" placeholder="Message Jargon" rows="1"></textarea>
      <button type="submit">Send</button>
    </form>
  </div>

  <script>
  const lessonPrompts = {
    lesson1: {
      title: "Purpose",
      systemPrompt: `You are the Lesson 1 Mentor from Book F Chapter 1... (trimmed)`
    },
    lesson2: {
      title: "Systems & Signals",
      systemPrompt: `You are the Lesson 2 Mentor...`
    },
    lesson3: {
      title: "Signal Processing",
      systemPrompt: `You are the Lesson 3 Mentor...`
    },
    lesson4: {
      title: "Memory",
      systemPrompt: `You are the Lesson 4 Mentor...`
    },
    lesson5: {
      title: "Exchanging Signals",
      systemPrompt: `You are the Lesson 5 Mentor...`
    }
  };
  
  let currentLesson = "lesson1";
  let chatHistory = [
    {
      role: "system",
      content: lessonPrompts[currentLesson].systemPrompt
    }
  ];
  
  const chatContainer = document.getElementById("chat-container");
  const inputField = document.getElementById("user-input");
  
  function setLesson(lessonKey) {
    currentLesson = lessonKey;
    chatHistory = [
      {
        role: "system",
        content: lessonPrompts[lessonKey].systemPrompt
      }
    ];
    chatContainer.innerHTML = "";
    appendMessage("assistant", `You are now speaking to the mentor for ${lessonPrompts[lessonKey].title}.`);
  }
  
  document.getElementById("lessonSelector").addEventListener("change", (e) => {
    setLesson(e.target.value);
  });
  
  function appendMessage(role, text) {
    const div = document.createElement("div");
    div.className = role;
    div.textContent = (role === "user" ? "You: " : "Mentor: ") + text;
    chatContainer.appendChild(div);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }
  
  async function sendMessage(event) {
    event.preventDefault();
    const message = inputField.value.trim();
    if (!message) return;
  
    appendMessage("user", message);
    chatHistory.push({ role: "user", content: message });
  
    inputField.value = "";
  
    const response = await fetch("/.netlify/functions/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ messages: chatHistory })
    });
  
    const data = await response.json();
    const reply = data.reply;
  
    appendMessage("assistant", reply);
    chatHistory.push({ role: "assistant", content: reply });
  }
  
  document.getElementById("chat-form").addEventListener("submit", sendMessage);
  </script>
</body>
</html>
